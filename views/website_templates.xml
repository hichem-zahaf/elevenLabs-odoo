<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Main AI Assistant Page Template -->
    <template id="ai_assistant_page" name="AI Shopping Assistant">
        <t t-call="website.layout">
            <t t-set="title">AI Shopping Assistant</t>
            <div id="wrap" class="oe_structure">
                <section class="s_title pt48 pb24">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12 text-center">
                                <h1 class="mb-3">
                                    <span class="text-gradient">AI Shopping Assistant</span>
                                </h1>
                                <p class="lead text-muted">
                                    Experience the future of shopping with our voice-enabled AI assistant
                                </p>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section class="s_features pt24 pb48">
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-lg-8">
                                <!-- Features Cards -->
                                <div class="row mb-4">
                                    <div class="col-md-4 text-center mb-3">
                                        <div class="feature-card p-3 h-100">
                                            <i class="fa fa-microphone fa-2x text-primary mb-2"/>
                                            <h5>Voice Interaction</h5>
                                            <p class="small text-muted">Talk naturally with our AI</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-center mb-3">
                                        <div class="feature-card p-3 h-100">
                                            <i class="fa fa-magic fa-2x text-primary mb-2"/>
                                            <h5>Smart Recommendations</h5>
                                            <p class="small text-muted">Personalized product suggestions</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-center mb-3">
                                        <div class="feature-card p-3 h-100">
                                            <i class="fa fa-shopping-cart fa-2x text-primary mb-2"/>
                                            <h5>Quick Cart Add</h5>
                                            <p class="small text-muted">Add items with voice commands</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Agent Container -->
                                <t t-set="agent_id" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.agent_id', '')"/>
                                <t t-set="agent_enabled" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.enabled', 'True') == 'True'"/>
                                <t t-set="widget_position" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.widget_position', 'bottom-right')"/>

                                <!-- Trigger Options -->
                                <t t-set="trigger_delay" t-value="int(request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.trigger_delay', '0'))"/>
                                <t t-set="trigger_on_scroll" t-value="float(request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.trigger_on_scroll', '0.0'))"/>
                                <t t-set="trigger_on_time" t-value="int(request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.trigger_on_time', '0'))"/>
                                <t t-set="trigger_on_exit_intent" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.trigger_on_exit_intent', 'False') == 'True'"/>
                                <t t-set="show_first_time_visitors_only" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.show_first_time_visitors_only', 'False') == 'True'"/>


                                <!-- Integration Controls -->
                                <t t-set="enable_show_product_card" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.enable_show_product_card', 'True') == 'True'"/>
                                <t t-set="enable_add_to_cart" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.enable_add_to_cart', 'True') == 'True'"/>
                                <t t-set="enable_search_products" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.enable_search_products', 'True') == 'True'"/>
                                <t t-set="cart_integration_method" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.cart_integration_method', 'direct_add')"/>

                                <!-- Targeting Controls -->
                                <t t-set="geographic_restrictions" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.geographic_restrictions', '')"/>
                                <t t-set="device_filtering" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.device_filtering', 'all')"/>
                                <t t-set="customer_segment_targeting" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.customer_segment_targeting', 'all')"/>
                                <t t-set="exclude_logged_in_users" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.exclude_logged_in_users', 'False') == 'True'"/>

                                <!-- Session Controls -->
                                <t t-set="max_messages_per_session" t-value="int(request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.max_messages_per_session', '0'))"/>
                                <t t-set="conversation_history_retention" t-value="int(request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.conversation_history_retention', '24'))"/>
                                <t t-set="auto_end_inactive_conversations" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.auto_end_inactive_conversations', 'True') == 'True'"/>
                                <t t-set="save_user_info" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.save_user_info', 'False') == 'True'"/>
                                <t t-set="enable_conversation_logging" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.enable_conversation_logging', 'False') == 'True'"/>
                                <t t-set="daily_usage_limit" t-value="int(request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.daily_usage_limit', '0'))"/>

                                <!-- Product Integration -->
                                <t t-set="product_categories_include" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.product_categories_include', '')"/>
                                <t t-set="product_categories_exclude" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.product_categories_exclude', '')"/>
                                <t t-set="featured_products_priority" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.featured_products_priority', '')"/>
                                <t t-set="out_of_stock_handling" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.out_of_stock_handling', 'hide')"/>

                                <!-- Page Visibility Controls -->
                                <t t-set="pages_to_show" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.pages_to_show', '')"/>
                                <t t-set="pages_to_hide" t-value="request.env['ir.config_parameter'].sudo().get_param('elevenlabs_agent.pages_to_hide', '')"/>

                                <!-- User Information -->
                                <t t-set="user" t-value="request.env.user"/>
                                <t t-set="user_id" t-value="user.id if not user._is_public() else 0"/>
                                <t t-set="user_name" t-value="user.name if not user._is_public() else 'Public User'"/>
                                <t t-set="user_login" t-value="user.login if not user._is_public() else ''"/>
                                <t t-set="user_email" t-value="user.email if not user._is_public() else ''"/>
                                <t t-set="user_is_public" t-value="user._is_public()"/>
                                <t t-set="user_is_admin" t-value="user.has_group('base.group_system')"/>

                                <div class="elevenlabs-agent-container"
                                     t-att-data-agent-id="agent_id"
                                     t-att-data-enabled="str(agent_enabled).lower()"
                                     t-att-data-widget-position="widget_position"
                                     t-att-data-trigger-delay="str(trigger_delay)"
                                     t-att-data-trigger-on-scroll="str(trigger_on_scroll)"
                                     t-att-data-trigger-on-time="str(trigger_on_time)"
                                     t-att-data-trigger-on-exit-intent="str(trigger_on_exit_intent).lower()"
                                     t-att-data-show-first-time-visitors-only="str(show_first_time_visitors_only).lower()"
                                     t-att-data-enable-show-product-card="str(enable_show_product_card).lower()"
                                     t-att-data-enable-add-to-cart="str(enable_add_to_cart).lower()"
                                     t-att-data-enable-search-products="str(enable_search_products).lower()"
                                     t-att-data-cart-integration-method="cart_integration_method"
                                     t-att-data-geographic-restrictions="geographic_restrictions"
                                     t-att-data-device-filtering="device_filtering"
                                     t-att-data-customer-segment-targeting="customer_segment_targeting"
                                     t-att-data-exclude-logged-in-users="str(exclude_logged_in_users).lower()"
                                     t-att-data-max-messages-per-session="str(max_messages_per_session)"
                                     t-att-data-conversation-history-retention="str(conversation_history_retention)"
                                     t-att-data-auto-end-inactive-conversations="str(auto_end_inactive_conversations).lower()"
                                     t-att-data-save-user-info="str(save_user_info).lower()"
                                     t-att-data-enable-conversation-logging="str(enable_conversation_logging).lower()"
                                     t-att-data-daily-usage-limit="str(daily_usage_limit)"
                                     t-att-data-product-categories-include="product_categories_include"
                                     t-att-data-product-categories-exclude="product_categories_exclude"
                                     t-att-data-featured-products-priority="featured_products_priority"
                                     t-att-data-out-of-stock-handling="out_of_stock_handling"
                                     t-att-data-pages-to-show="pages_to_show"
                                     t-att-data-pages-to-hide="pages_to_hide"
                                     t-att-data-user-id="str(user_id)"
                                     t-att-data-user-name="str(user_name)"
                                     t-att-data-user-login="str(user_login)"
                                     t-att-data-user-email="str(user_email)"
                                     t-att-data-user-is-public="str(user_is_public).lower()"
                                     t-att-data-user-is-admin="str(user_is_admin).lower()">
                                    <!-- Widget will be dynamically inserted by JavaScript -->
                                </div>
                                
                                <!-- Test Buttons (controlled via JavaScript based on URL parameter) -->
                                <div class="elevenlabs-test-buttons" style="display: none;">
                                    <button id="test-recommendations" class="btn btn-secondary btn-sm">
                                        <i class="fa fa-flask"/> Test Recommendations
                                    </button>
                                    <button id="test-cart" class="btn btn-primary btn-sm">
                                        <i class="fa fa-shopping-cart"/> Test Cart
                                    </button>
                                </div>
                                
                                <!-- Instructions -->
                                <div class="alert alert-info mt-4">
                                    <h5 class="alert-heading">
                                        <i class="fa fa-info-circle"/> How to use:
                                    </h5>
                                    <ul class="mb-0">
                                        <li>Click the microphone icon to start talking</li>
                                        <li>Ask for product recommendations: "Show me wireless headphones"</li>
                                        <li>Add items to cart: "Add Sony headphones to my cart"</li>
                                        <li>Get help: "What can you help me with?"</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Custom styles for this page -->
            <style>
                .text-gradient {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                }
                
                .feature-card {
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    transition: transform 0.2s, box-shadow 0.2s;
                }
                
                .feature-card:hover {
                    transform: translateY(-4px);
                    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
                }
                
                elevenlabs-convai {
                    display: block;
                    min-height: 400px;
                }
            </style>
            
            <!-- Include module assets (CSS and JS) -->
            <t t-call="elevenlabs_agent.elevenlabs_assets"/>
        </t>
    </template>
    
    <!-- Menu Item -->
    <record id="menu_ai_assistant" model="website.menu">
        <field name="name">AI Assistant</field>
        <field name="url">/ai-assistant</field>
        <field name="parent_id" ref="website.main_menu"/>
        <field name="sequence">50</field>
    </record>
</odoo>